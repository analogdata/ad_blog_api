# Author-User Relationship Documentation

This document describes the implementation of the relationship between User and Author models in the blog API.

## Overview

The system implements a one-to-one relationship between User and Author models:

- A User with the AUTHOR role can have one associated Author profile
- An Author can be associated with one User
- The relationship is maintained via the `author_id` foreign key in the User model

## Automatic Author Creation

When a user with the AUTHOR role is registered, an Author profile is automatically created:

1. The system uses the user's full name (first_name + " " + last_name) as the author name
2. If the name already exists, a unique name is generated by appending a number
3. The author profile is linked to the user via the `author_id` field

Implementation: `register_user()` in `app/api/v1/auth/service.py`

## Permission Model

The system implements the following permission model:

1. **Admin Users**:
   - Can create new authors
   - Can update any author profile
   - Can delete any author
   - Can manage social media links for any author

2. **Author Users**:
   - Can view their own author profile
   - Can update their own author profile
   - Can manage social media links for their own profile
   - Cannot create or delete author profiles

## API Endpoints

### Admin-Only Endpoints

- `POST /api/v1/author` - Create a new author
- `PUT /api/v1/author/{author_id}` - Full update of an author
- `PATCH /api/v1/author/{author_id}` - Partial update of an author
- `DELETE /api/v1/author/{author_id}` - Delete an author
- `POST /api/v1/author/{author_id}/social-media` - Add/update social media for an author
- `DELETE /api/v1/author/{author_id}/social-media/{platform}` - Delete social media for an author

### Author Self-Management Endpoints

- `GET /api/v1/author/me` - Get author's own profile
- `PATCH /api/v1/author/me` - Update author's own profile
- `POST /api/v1/author/me/social-media` - Add/update social media for own profile
- `DELETE /api/v1/author/me/social-media/{platform}` - Delete social media from own profile

### Public Endpoints

- `GET /api/v1/author` - Get all authors (paginated)
- `GET /api/v1/author/{author_id}` - Get author by ID
- `GET /api/v1/author/slug/{slug}` - Get author by slug
- `GET /api/v1/author/popular` - Get popular authors with article count

## Data Synchronization

The system keeps user and author data synchronized:

1. When a user updates their profile (name, profile image), the author profile is updated
2. The `sync_user_author_data()` function handles this synchronization
3. Name changes trigger slug regeneration for the author

Implementation: `sync_user_author_data()` in `app/api/v1/auth/service.py`

## Testing

Use the following REST client files to test the implementation:

- `check/api/author.rest` - Tests for admin-only author endpoints
- `check/api/author_self.rest` - Tests for author self-management endpoints

## Security Considerations

1. All author management endpoints are protected with appropriate authentication
2. Admin-only endpoints use `Security(get_admin_user)` to enforce admin role
3. Author self-management endpoints use `Security(get_author_user)` to allow both author and admin roles
4. Each endpoint validates that the user has permission to access the requested author
